{% extends 'base.html.twig' %}

{% block title %}Match #{{ match_id }}{% endblock %}
{% block body_class %}page-match{% endblock %}

{% block main %}
<section class="match container">
  <header class="match__header">
    <h1>Match #{{ match_id }}</h1>
    <div class="match__controls">
      <button class="btn btn-primary" id="btn-start">‚ñ∂ D√©marrer</button>
      <button class="btn btn-ghost"   id="btn-pause">‚è∏ Pause</button>
        <button class="btn btn-ghost"   id="btn-reset">‚Ü∫ Reset</button>
  <button class="btn btn-ghost"   id="btn-music" aria-pressed="false" title="Activer/D√©sactiver la musique">üé∂ Musique</button>
    </div>
  </header>

  <div class="match__layout">
    <aside class="hud hud--left">
  <h3 id="hud-allies-title">Alli√©s</h3>
      <ul id="hud-allies"></ul>
    </aside>

    <main class="board-wrap">
      <div class="board" id="board" data-cols="7" data-rows="4">
        {% for r in 0..3 %}
          {% for c in 0..6 %}
            <div class="cell" data-x="{{ c }}" data-y="{{ r }}"></div>
          {% endfor %}
        {% endfor %}
      </div>
      <div class="log" id="battle-log"></div>
    </main>

    <aside class="hud hud--right">
  <h3 id="hud-enemies-title">Ennemis</h3>
      <ul id="hud-enemies"></ul>
    </aside>
  </div>
</section>

{# Overlay r√©sultat victoire/d√©faite #}
<div id="result-overlay" class="result-overlay is-hidden" role="dialog" aria-modal="true" aria-live="assertive">
  <div class="result-frame">
    <button class="sound-toggle" id="result-sound-toggle" title="Activer/D√©sactiver le son" aria-pressed="false">üîä</button>
    <div class="result-text" id="result-text">VICTOIRE</div>
    <div class="result-actions">
      <button class="btn btn-primary" id="btn-result-continue">Continuer</button>
    </div>
    <div class="result-stars" aria-hidden="true">
      <span class="tw"></span><span class="tw"></span><span class="tw"></span>
      <span class="tw"></span><span class="tw"></span><span class="tw"></span>
      <span class="tw"></span><span class="tw"></span><span class="tw"></span>
    </div>
  </div>
  <div class="result-veil" aria-hidden="true"></div>
</div>

  <script id="allies-json"  type="application/json">{{ allies  |json_encode()|raw }}</script>
  <script id="enemies-json" type="application/json">{{ enemies |json_encode()|raw }}</script>
  <script>window.ASSET_BASE = "{{ asset('') }}";</script>
  <script id="replay-json" type="application/json">{{ replay|json_encode()|raw }}</script>
  {# Provide items catalog for icon/name resolution (safe default to empty) #}
  <script>window.ITEMS = {{ items|default([])|json_encode()|raw }};</script>
  <script>window.BGM_URL = "{{ asset('audio/battle_theme.mp3') }}";</script>
  <script>window.SFX_VICTORY_URL = "{{ asset('audio/victory.mp3') }}";</script>
  <script>
    window.SFX_DEFEAT_URL      = "{{ asset('audio/defeat.mp3') }}";
    window.SFX_HEAL_URL        = "{{ asset('audio/heal.mp3') }}";
    window.SFX_HEAL_CRIT_URL   = "{{ asset('audio/heal_crit.mp3') }}";
    window.SFX_HALFHP_URL      = "{{ asset('audio/half_hp.mp3') }}";
    window.SFX_DEATH_URL       = "{{ asset('audio/death.mp3') }}";
    // Special FX GIFs: place your files in public/images/fx/ with these names
    window.FX_URLS = {
      healer_blessing:  "{{ asset('images/fx/healer_blessing.gif') }}",
      melee_brise:      "{{ asset('images/fx/melee_brise.gif') }}",
      ranged_soleil:    "{{ asset('images/fx/ranged_soleil.gif') }}",
      ranged_lune:      "{{ asset('images/fx/ranged_lune.gif') }}",
      ranged_nature:    "{{ asset('images/fx/ranged_nature.gif') }}",
      ranged_idole:     "{{ asset('images/fx/ranged_idole.gif') }}",
      ranged_ombre:     "{{ asset('images/fx/ranged_ombre.gif') }}",
      ranged_arcane:    "{{ asset('images/fx/ranged_arcane.gif') }}",
      ranged_etoile:    "{{ asset('images/fx/ranged_etoile.gif') }}",
      ranged_ocean:     "{{ asset('images/fx/ranged_ocean.gif') }}",
      tank_rempart:     "{{ asset('images/fx/tank_rempart.gif') }}",
      default:          "{{ asset('images/fx/default.gif') }}"
    };
  </script>
{% endblock %}
{# templates/match/show.html.twig #}
{% block javascripts %}
  {{ parent() }}   {# <= garde seulement l‚Äôentr√©e "app" #}
{% endblock %}
